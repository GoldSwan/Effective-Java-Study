### 옵셔널 반환은 신중히 하라

Java 8 이전 특정 조건에서 값을 반환할 수 없을 때 취할 수 있는 선택지 2가지

- 1.예외를 던짐
  - 예외적인 상황에서만 예외를 던져야 좋음
  - 스택 추적 전체를 캡처하므로 큰 비용 발생
- 2.null을 반환
  - null 처리 코드를 추가해야함
  - null 처리 무시할 경우 이상한 곳에서 nullPointerException 발생 가능성 있음

Java 8 다른 선택지

- Optional<T> 사용
  - null이 아닌 T타입 참조를 담거나 아무것도 담지 않을 수 있음
  - 특정 조건에서 값을 반환할 수 없을 시 T 대신 Optional<T> 반환

Optional 정의
- 원소를 최대 1개 가질 수 있는 불변 컬랙션

Optional<T> 반환 메서드 장점
- 예외를 던지는 메서드보다 유연, 사용성 쉬움
- null 반환 메서드보다 오류 가능성 낮음

[예외를 던지는 예]
```java
public class Max {
    public static <E extends Comparable<E>> E max(Collection<E> c) {
        if (c.isEmpty())
            throw new IllegalArgumentException("빈 컬렉션");

        E result = null;
        for (E e : c)
            if (result == null || e.compareTo(result) > 0)
                result = Objects.requireNonNull(e);

        return result;
    }
}
```
[예외 대신 Optional<T>을 반환하는 예]
```java
public class Max {
    public static <E extends Comparable<E>>
    Optional<E> max(Collection<E> c) {
        if (c.isEmpty())
            return Optional.empty();//빈 Optional 반환

        E result = null;
        for (E e : c)
            if (result == null || e.compareTo(result) > 0)
                result = Objects.requireNonNull(e);

        return Optional.of(result);
    }
}
```
- Optional.of(value)에 null을 넣으면 nullPointerException 발생하니 주의
- Optional 반환 메서드에서는 반드시 null 반환하지 않기!!! > null 반환 시 Optional 도입 취지가 무너짐...

[Strean max 연산을 통해 Optional<T>을 반환하는 예]
```java
public class Max {
  public static <E extends Comparable<E>>
  Optional<E> max(Collection<E> c) {
      return c.stream().max(Comparator.naturalOrder());
  }
}
```

null반환, 예외 던지기 대신 Optional 반환을 선택해야 하는 기준
- 검사 예외 던져서 클라이언트에서 대처 코드 만들게 하기
  - 반환값이 없을 수도 있음을 API 사용자에게 명확히 알려줌

클라이언트에서 취할 행동

[1.기본값을 정하기]
```java
String lastWordInLexicon = max(words).orElse("단어 없음...");
```
[2.원하는 예외 던지기]
```java
Toy myToy = max(toys).orElseThrow(TemperTantrumException::new);
```
- 예외 팩터리를 건넴으로써 실제 예외가 발생하지 않는 한 예외 생성 비용이 들지않는다.

[3.항상 값이 채워져 있다고 가정]
```java
Element lastNobleGas = max(Elements.NOBLE_GASES).get();
```
- 단 안채워져 있을 경우 NoSuchElementException 발생하므로 주의

기본값 설정 비용이 클경우
- orElseGet 사용 > 값 처음 생성시 Supplier<T> 사용하여 생성하므로 초기 비용 줄임
- filter, map, flatMap, ifPresent 고급 메서드 활용
- isPresent 사용
  - Optional 채워져 있으면 true, 비어 있으면 false 반환
  - 위 메서드들로도 충분히 구현이 가능하다면 사용 권장 x

[잘못된 isPresent 사용 예]
```java
Optional<ProcessHandle> parentProcess = ph.parent();
System.out.println("부모 PID: " + (parentProcess.isPresent() ?
        String.valueOf(parentProcess.get().pid()) : "N/A"));
```
[map을 이용한 개선 코드 - Java 9]
```java
System.out.println("부모 PID: " +
    ph.parent().map(h -> String.valueOf(h.pid())).orElse("N/A"));
```
[Java 8 구현 예]
```java
streamOfOptionals.filter(Optional::isPresent).map(Optional::get);
```
