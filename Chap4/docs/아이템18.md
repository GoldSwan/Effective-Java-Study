### 상속의 위험성

- 이 이야기에서 하는 상속의 정의 : 클래스가 다른 클래스를 확장하는 구현 상속
    - (클래스 - 인터페이스 구현, 인터페이스 - 인터페이스 확장 개념 x)
- 상속은 코드를 재사용하기에 강력한 수단이지만 항상 최선이 아니다.
- 같은 프로그래머가 개발하는 패키지 안에서의 상속은 안전한 방법이다. 그러나 다른 패키지의 클래스는 상속하는 것은 위험

- 메서드 호출과 달리 상속은 캡슐화를 깨뜨린다.
    - 상위 클래스 구현에 따라 하위 클래스 동작에 이상이 생길 수 있다.
    - 상위 클래스를 배포할 때 마다 내부 구현이 달라질 수 있다. 이로 인해 코드를 하나도 건드리지 않는 하위 클래스가 오작동을 할 수 있다.

오작동의 구체적인 예

HashSet의 성능을 높이기 위해 처음 생성 후 원소가 몇개 더해졌는지 계산하는 클래스를 상속을 이용하여 구현

문제점

- 것보기엔 잘 상속을 구현한 것 처럼 보이나 addAll이 add 메서드를 사용해 구현하므로 addAll을 호출하면 size를 addCount에 더하여 3이 더해지고 add를 3번 호출하여 6이 된다. 따라서 3원소만 추가했는데 6이 되므로 의도와 다르게 동작한다.

```java
public class InstrumentedHashSet<E> extends HashSet<E> {

    private int addCount = 0;

    public InstrumentedHashSet() {
    }

    public InstrumentedHashSet(int initCap, float loadFactor) {
        super(initCap, loadFactor);
    }

    @Override public boolean add(E e) {
        addCount++;
        return super.add(e);
    }

    @Override public boolean addAll(Collection<? extends E> c) {
        addCount += c.size();
        return super.addAll(c);
    }

    public int getAddCount() {
        return addCount;
    }

    public static void main(String[] args) {
        InstrumentedHashSet<String> s = new InstrumentedHashSet<>();
        s.addAll(List.of("틱", "탁탁", "펑"));
        System.out.println(s.getAddCount());
    }
}
```
